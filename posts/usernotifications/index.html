<!doctype html><html lang=en-us><title>UserNotifications | Blog by Frank</title><meta charset=utf-8><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZQ6YTCMN7"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XZQ6YTCMN7",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta property="og:type" content="article"><meta property="og:title" content="UserNotifications | Blog by Frank"><meta name=twitter:title content="UserNotifications | Blog by Frank"><meta property="og:description" content="Quick Start
Scheduling local notifications

Scheduling local notifications"><meta property="og:url" content="https://yongfrank.github.io/posts/usernotifications/"><meta property="og:site_name" content="Blog by Frank"><meta name=generator content="Hugo 0.115.1"><meta name=description content="Explorations, Reflections, and More on My Blog"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://yongfrank.github.io/css/index.css><link rel=canonical href=https://yongfrank.github.io/posts/usernotifications/><link rel=alternate type=application/rss+xml href title="Blog by Frank"><link rel=stylesheet href=https://yongfrank.github.io/katex/katex.min.css><link rel="shortcut icon" href=favicon.ico><script defer src=https://yongfrank.github.io/katex/katex.min.js></script>
<script defer src=https://yongfrank.github.io/katex/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#578490><meta name=msapplication-TileColor content="#da532c"><head><script src=/js/MathJax/es5/tex-chtml.js></script></head><header><a href=https://yongfrank.github.io/ class=title>Blog by Frank</a><nav><a href=/about/>About</a></nav></header><article><header><h1>UserNotifications</h1><time datetime=2023-05-12T11:36:13+08:00>May 12, 2023</time></header><nav id=TableOfContents><ul><li><a href=#quick-start>Quick Start</a><ul><li><a href=#scheduling-local-notifications>Scheduling local notifications</a></li><li><a href=#authorization-status>Authorization Status</a></li><li><a href=#full-code>Full Code</a></li></ul></li><li><a href=#open-system-settings>Open System Settings</a></li><li><a href=#system-notification-authorization-status>System Notification Authorization Status</a></li><li><a href=#open-app-settings-from-system-settings>Open App Settings From System Settings</a></li></ul></nav><h2 id=quick-start>Quick Start</h2><h3 id=scheduling-local-notifications>Scheduling local notifications</h3><blockquote><p><a href=https://www.hackingwithswift.com/books/ios-swiftui/scheduling-local-notifications>Scheduling local notifications</a></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>&#34;NotificationsTesting&#34; Would Like to Send You Notifications
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Notifications may include alerts, sounds, and icon badges. These can be configured in Settings.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> --------------------------
</span></span><span style=display:flex><span>| Dont&#39;t Allow |   Allow   |
</span></span><span style=display:flex><span> --------------------------
</span></span></code></pre></div><blockquote><p><a href=https://developer.apple.com/documentation/usernotifications/asking_permission_to_use_notifications>Asking permission to use notifications</a></p></blockquote><p><img src=https://docs-assets.developer.apple.com/published/c8879aa786/3559454@2x.png alt=Notifications></p><p>The ability to post noninterrupting notifications provisionally to the Notification Center.</p><p><img src=https://docs-assets.developer.apple.com/published/75a57b5a99/3544497@2x.png alt="Provisional Notifications"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> center = UNUserNotificationCenter.current()
</span></span><span style=display:flex><span>center.requestAuthorization(options: [.alert, .sound, .badge, .provisional]) { granted, error <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> error = error {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Handle the error here.</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Provisional authorization granted.</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Unlike explicitly requesting authorization, this code doesn’t prompt the user for permission to receive notifications. Instead, the first time you call this method, it automatically grants authorization. However, until the user either explicitly keeps or turns off the notification, the authorization status is UNAuthorizationStatus.provisional. Because users can change the authorization status at any point, you should still check the status before scheduling local notifications.</p><h3 id=authorization-status>Authorization Status</h3><blockquote><p><a href=https://developer.apple.com/documentation/usernotifications/asking_permission_to_use_notifications#2941986>Customize notifications based on the current authorizations</a></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> center = UNUserNotificationCenter.current()
</span></span><span style=display:flex><span>center.getNotificationSettings { settings <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>guard</span> (settings.authorizationStatus == .authorized) <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>          (settings.authorizationStatus == .provisional) <span style=color:#66d9ef>else</span> { <span style=color:#66d9ef>return</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> settings.alertSetting == .enabled {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Schedule an alert-only notification.</span>
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Schedule a notification with a badge and sound.</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The above example uses a guard condition to prevent the scheduling of notifications if the app isn’t authorized. The code then configures the notification based on the types of interactions allowed, preferring the use of an alert-based notification whenever possible.</p><h3 id=full-code>Full Code</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>SwiftUI</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>UserNotifications</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>AlertToast</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> showToast = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> alertTitle = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        VStack {
</span></span><span style=display:flex><span>            Image(systemName: <span style=color:#e6db74>&#34;globe&#34;</span>)
</span></span><span style=display:flex><span>                .imageScale(.large)
</span></span><span style=display:flex><span>                .foregroundColor(.accentColor)
</span></span><span style=display:flex><span>            Text(<span style=color:#e6db74>&#34;Hello, world!&#34;</span>)
</span></span><span style=display:flex><span>            Button(<span style=color:#e6db74>&#34;Request Permission&#34;</span>) {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// First, Authorization </span>
</span></span><span style=display:flex><span>                UNUserNotificationCenter.current().requestAuthorization(options: [.alert, .badge, .sound]) { success, error <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> success {
</span></span><span style=display:flex><span>                        showToast.toggle()
</span></span><span style=display:flex><span>                        alertTitle = <span style=color:#e6db74>&#34;Success&#34;</span>
</span></span><span style=display:flex><span>                    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> error = error {
</span></span><span style=display:flex><span>                        print(error.localizedDescription)
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            .alert(alertTitle, isPresented: <span style=color:#960050;background-color:#1e0010>$</span>showToast) {}
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            Button(<span style=color:#e6db74>&#34;Schedule Notification&#34;</span>) {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Second, Schedule Notification</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> content = UNMutableNotificationContent()
</span></span><span style=display:flex><span>                content.title = <span style=color:#e6db74>&#34;Feed the cat&#34;</span>
</span></span><span style=display:flex><span>                content.subtitle = <span style=color:#e6db74>&#34;It looks hungry&#34;</span>
</span></span><span style=display:flex><span>                content.sound = UNNotificationSound.<span style=color:#66d9ef>default</span>
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#75715e>// show this notification five seconds from now</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> trigger = UNTimeIntervalNotificationTrigger(timeInterval: <span style=color:#ae81ff>5</span>, repeats: <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#75715e>// choose a random identifier</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> request = UNNotificationRequest(identifier: UUID().uuidString, content: content, trigger: trigger)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#75715e>// add our notification request</span>
</span></span><span style=display:flex><span>                UNUserNotificationCenter.current().add(request)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                showToast.toggle()
</span></span><span style=display:flex><span>                alertTitle = <span style=color:#e6db74>&#34;Notification is coming&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        .padding()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView_Previews</span>: PreviewProvider {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>var</span> previews: some View {
</span></span><span style=display:flex><span>        ContentView()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=open-system-settings>Open System Settings</h2><blockquote><ul><li><p><a href=https://www.jianshu.com/p/ddeebec23e90>iOS获取通知状态并跳转设置界面设置</a></p></li><li><p><a href=https://stackoverflow.com/questions/28152526/how-do-i-open-phone-settings-when-a-button-is-clicked>How do I open phone settings when a button is clicked?</a></p></li><li><p><a href=https://stackoverflow.com/questions/42848539/opening-apps-notification-settings-in-the-settings-app>Opening app&rsquo;s notification settings in the settings app</a></p></li></ul></blockquote><h2 id=system-notification-authorization-status>System Notification Authorization Status</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#75715e>#pragma mark - Notifications
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>/// 添加系统通知状态的观察者
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>addObserverForSystemNotificationStatus</span> {
</span></span><span style=display:flex><span>    [[NSNotificationCenter defaultCenter] addObserver:self
</span></span><span style=display:flex><span>                                             selector:<span style=color:#66d9ef>@selector</span>(checkNotificationAuthorization)
</span></span><span style=display:flex><span>                                                 name:UIApplicationWillEnterForegroundNotification
</span></span><span style=display:flex><span>                                               object:nil];
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// 在 checkNotificationAuthorization 方法中检查通知权限
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>checkNotificationAuthorization</span> {
</span></span><span style=display:flex><span>    [[UNUserNotificationCenter currentNotificationCenter] getNotificationSettingsWithCompletionHandler:<span style=color:#f92672>^</span>(UNNotificationSettings <span style=color:#f92672>*</span> _Nonnull settings) {
</span></span><span style=display:flex><span>        dispatch_async(dispatch_get_main_queue(), <span style=color:#f92672>^</span>{
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>BOOL</span> newAuthorizationStatus <span style=color:#f92672>=</span> self.isSystemNotificationOn;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (settings.authorizationStatus <span style=color:#f92672>==</span> UNAuthorizationStatusAuthorized) {
</span></span><span style=display:flex><span>                newAuthorizationStatus <span style=color:#f92672>=</span> YES;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                newAuthorizationStatus <span style=color:#f92672>=</span> NO;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#75715e>// iOS 12.0 新增了 Provisional 的状态，无需获得用户授权也可发送 Deliver Quietly 的通知
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (@available(iOS <span style=color:#ae81ff>12.0</span>, <span style=color:#f92672>*</span>)) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (settings.authorizationStatus <span style=color:#f92672>==</span> UNAuthorizationStatusProvisional) {
</span></span><span style=display:flex><span>                    newAuthorizationStatus <span style=color:#f92672>=</span> YES;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 刷新表格
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (newAuthorizationStatus <span style=color:#f92672>!=</span> self.isSystemNotificationOn) {
</span></span><span style=display:flex><span>                self.isSystemNotificationOn <span style=color:#f92672>=</span> newAuthorizationStatus;
</span></span><span style=display:flex><span>                [self.tableView reloadData];
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=open-app-settings-from-system-settings>Open App Settings From System Settings</h2><blockquote><p><a href=https://developer.apple.com/documentation/usernotifications/unauthorizationoptions/2990405-providesappnotificationsettings>providesAppNotificationSettings</a></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>userNotificationCenter:</span>(UNUserNotificationCenter <span style=color:#f92672>*</span>)center <span style=color:#a6e22e>openSettingsForNotification:</span>(UNNotification <span style=color:#f92672>*</span>)notification {
</span></span><span style=display:flex><span>    NSURL <span style=color:#f92672>*</span>url <span style=color:#f92672>=</span> [NSURL URLWithString:<span style=color:#e6db74>@&#34;https://google.com&#34;</span>];
</span></span><span style=display:flex><span>    [self openTrdPartyURL:url];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>iOS 12.0+</p><p>An option indicating the system should display a button for in-app notification settings.</p><blockquote><p><a href=https://www.smashingmagazine.com/2018/09/preparing-your-app-for-ios-12-notifications/>Preparing Your App For iOS 12 Notifications</a></p></blockquote><p><img src=https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_2000/https://archive.smashing.media/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/c4ee20c1-ca99-419b-bfa4-4f5ebbffabf3/app-ios-12-notifications-turnoffnotifications.png alt="Deep link to to custom notification settings for NotificationTester from notification in the Notification Center."></p><p><img src=https://res.cloudinary.com/indysigner/image/fetch/f_auto,q_80/w_2000/https://archive.smashing.media/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/45e51038-8365-4064-ab03-feee8cc56eef/app-ios-12-notifications-systemnotificationsettings.png alt="System Notification Settings"></p></article></html>