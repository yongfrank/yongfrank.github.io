<!doctype html><html lang=en-us><title>Singleton and Data Design in Swift / SwiftUI | Blog by Frank</title><meta charset=utf-8><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZQ6YTCMN7"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XZQ6YTCMN7")}</script><meta name=twitter:card content="summary_large_image"><meta property="og:type" content="article"><meta property="og:title" content="Singleton and Data Design in Swift / SwiftUI | Blog by Frank"><meta name=twitter:title content="Singleton and Data Design in Swift / SwiftUI | Blog by Frank"><meta property="og:description" content='Swift Class vs Struct, which is better for Model Design
// using struct。
var herDog = Dog() {
    // if herDog is changed, print message.
    didSet {
        print("Her dog is changed!")
    }
}

herDog.name = "Starlord"
// Her dog is changed!

// using class。
var herCat = Cat() {
    didSet {
        print("Her cat is changed!")
    }
}

herCat.name = "Mumu"
// No print message.
'><meta property="og:url" content="https://yongfrank.github.io/posts/singleton-in-swift/"><meta property="og:site_name" content="Blog by Frank"><meta name=generator content="Hugo 0.154.2"><meta name=description content="Explorations, Reflections, and More on My Blog"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://yongfrank.github.io/css/index.css><link rel=canonical href=https://yongfrank.github.io/posts/singleton-in-swift/><link rel=alternate type=application/rss+xml href title="Blog by Frank"><link rel=stylesheet href=https://yongfrank.github.io/katex/katex.min.css><link rel="shortcut icon" href=favicon.ico><script defer src=https://yongfrank.github.io/katex/katex.min.js></script><script defer src=https://yongfrank.github.io/katex/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#578490><meta name=msapplication-TileColor content="#da532c"><head><script src=/js/MathJax/es5/tex-chtml.js></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6555780148434263" crossorigin=anonymous></script></head><header><a href=https://yongfrank.github.io/ class=title>Blog by Frank</a><nav><a href=/about/>About</a></nav></header><article><header><h1>Singleton and Data Design in Swift / SwiftUI</h1><time datetime=2023-03-25T01:39:04+08:00>March 25, 2023</time></header><nav id=TableOfContents><ul><li><a href=#swift-class-vs-struct-which-is-better-for-model-design>Swift Class vs Struct, which is better for Model Design</a></li><li><a href=#static-variable-and-class-variable>static variable and class variable</a></li><li><a href=#required-init>Required init</a></li><li><a href=#mvc-and-singleton>MVC and Singleton</a></li><li><a href=#stateobject-and-observedobject>@StateObject and @ObservedObject</a></li><li><a href=#observableobject>ObservableObject</a></li><li><a href=#custom-subclass-of-nsobject>Custom Subclass of NSObject</a></li><li><a href=#getter--setter-and-property-wrapper>Getter / Setter and Property Wrapper</a></li></ul></nav><h2 id=swift-class-vs-struct-which-is-better-for-model-design><a href=https://www.appcoda.com.tw/swift-class/>Swift Class vs Struct, which is better for Model Design</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// using struct。</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> herDog = Dog() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// if herDog is changed, print message.</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>didSet</span> {
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Her dog is changed!&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>herDog.name = <span style=color:#e6db74>&#34;Starlord&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Her dog is changed!</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// using class。</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> herCat = Cat() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>didSet</span> {
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Her cat is changed!&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>herCat.name = <span style=color:#e6db74>&#34;Mumu&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// No print message.</span>
</span></span></code></pre></div><p><img src=https://docs-assets.developer.apple.com/published/4e7c26b6ad/ff7aa08f-4857-44ce-88d5-7dacbef84509.png alt="MVC by Apple"></p><p><img src=https://developer.apple.com/library/archive/documentation/General/Conceptual/DevPedia-CocoaCore/Art/model_view_controller_2x.png alt="model view controller"></p><blockquote><p>有了以上這些資訊，我們可以推導出，文件 Document 最好用 class 來寫。怎麼說呢？首先，文件必須要有一個持續存在的實體，如此才能夠隨時通知 controller 資料的變動，並且進行非同步或甚至自動的資料更新。這點 struct 與 class 都辦得到：</p><p>Engrmation above, we can deduce that document should be written by class. Why? First of all, document must have a persistent instance, so that it can notify controller of data change at any time, and perform asynchronous or even automatic data update. Both struct and class can do this</p><p>但如果 Document 是 struct 的話，它的實體就會直接活在 ViewController.document 裡面，像這樣：</p><p>But if Document is struct, its instance will live directly in ViewController.document, like this:</p></blockquote><p><img src=https://www.appcoda.com.tw/content/images/2018/12/DraggedImage-1-1.png alt="Struct in ViewController"></p><blockquote><p>這樣已經稍微打破 MVC 的區隔了，但還不算甚麼大問題。真正的大問題出現在當我們將 document 指派給新辨識符，或者傳給函式當參數的時候。如果文件是 class 的話，所有這些動作都只會複製 Document 實體的位址，不會複製實體本身：</p><p>This is slightly breaking the MVC separation, but it’s not a big problem. The real big problem comes when we assign document to a new identifier, or pass it to a function as a parameter. If the document is a class, all these actions will only copy the address of the Document instance, not the instance itself</p></blockquote><p><img src=https://www.appcoda.com.tw/content/images/2018/12/DraggedImage-2-1.png alt="Class in ViewController"></p><p><img src=https://www.appcoda.com.tw/content/images/2018/12/DraggedImage-3-1.png alt="Problem if we use struct"></p><blockquote><p>每次指派都會複製一個新的實體出來。這對於文件的職責來說，不只不必要，還會造成混淆。文件必須要持續存在才能發揮功用，所以當我們用了某一個實體，我們就必須確保接下來這個實體會持續存在，而且我們只能繼續用這個實體。Class 的遠端性設計確保了不管怎麼換辨識符，它的實體都只會有一個；但 struct 的本地性設計就讓實體的複製變得非常簡單，因此我們很容易不小心就複製了實體而不自知。所以，文件定義成 class 會是比較合理的做法。</p><p>Each assignment will copy a new instance out. This is not only unnecessary for the document, but also confusing. The document must exist to be useful, so when we use an instance, we must ensure that the instance will continue to exist, and we can only use the instance. The remote design of Class guarantees that no matter how the identifier is replaced, its instance will only have one; but the local design of struct makes the instance copy very easy, so we easily copy the instance without knowing it. So, defining the document as class will be a more reasonable approach.</p><p>總的來說，用 class 來定義資料物件的話，就好像是在用雲端共享文件一樣：每個人的螢幕上都會有一份文件可以編輯，但這個文件並沒有存在電腦裡，而是跟雲端的版本連線，所以所有的變動都是直接在雲端版本上更新的。好處是方便，壞處是誰修改了甚麼東西經理不會知道（class 本身沒有帳號功能！）。</p><p>In summary, using class to define data objects is like using a cloud-shared document: everyone’s screen will have a document that can be edited, but the document does not exist on the computer, but is connected to the cloud version, so all changes are directly updated on the cloud version. The benefit is convenient, the disadvantage is that the manager does not know who modified what (class itself has no account function!).</p></blockquote><blockquote><p>只有一個 Controller 物件能存取文件</p><p>Only one Controller object can access the document</p><p>如果不想要在每個 controller 物件的定義裡都去處理對文件的溝通的話，可以只讓一個主要的 controller 物件去管理文件就好，比方說 AppDelegate 或者是某個根 view controller。讓這個主要的 controller 物件拿到文件裡的資料物件之後，再把資料物件直接傳給別的 controller 物件來用：</p><p>if you don’t want to handle the communication with the document in the definition of each controller object, you can only let a primary controller object manage the document, such as AppDelegate or a root view controller. After the primary controller object gets the data object in the document, it passes the data object directly to other controller objects to use:</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// singleton</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PostManager</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>let</span> shared = PostManager()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PostTableViewController</span>: UITableViewController {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 只有這裡才能存取 postManager。</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> postManager = PostManager()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>presentPostViewController</span>(post: Post) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> postVC = PostViewController()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 只需傳遞資料物件過去。</span>
</span></span><span style=display:flex><span>        postVC.post = post
</span></span><span style=display:flex><span>        present(postVC, animated: <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PostViewController</span>: UIViewController {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 只需管理一個資料物件。</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> post: Post?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>viewDidAppear</span>(animated: Bool) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.viewDidAppear(animated: animated)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 直接拿資料物件來用。</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> post = <span style=color:#66d9ef>self</span>.post {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 顯示 post。</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=static-variable-and-class-variable>static variable and class variable</h2><blockquote><p><a href=https://www.hackingwithswift.com/example-code/language/whats-the-difference-between-a-static-variable-and-a-class-variable>What’s the difference between a static variable and a class variable?</a></p><p>Both the static and class keywords allow us to attach variables to a class rather than to instances of a class. For example, you might create a Student class with properties such as name and age, then create a static numberOfStudents property that is owned by the Student class itself rather than individual instances.</p><p>Where static and class differ is how they support <code>inheritance</code>: When you make a static property it becomes owned by the class and cannot be changed by subclasses, whereas when you use class it may be overridden if needed.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Person</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>var</span> count: Int {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>250</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>var</span> averageAge: Double {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Student</span>: Person {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// THIS ISN&#39;T ALLOWED</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// override static var count: Int {</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//    return 150</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// }</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// THIS IS ALLOWED</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>var</span> averageAge: Double {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>19.5</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=required-init>Required init</h2><ul><li><a href=https://blog.csdn.net/u010707262/article/details/118181259>required init</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Animal</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> name: String
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>required</span> <span style=color:#66d9ef>init</span>(name: String) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.name = name
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Animal initialized&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Dog</span>: Animal {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> breed: String
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>init</span>(name: String, breed: String) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.breed = breed
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Dog initialized&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.<span style=color:#66d9ef>init</span>(name: <span style=color:#e6db74>&#34;dogie&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>required</span> <span style=color:#66d9ef>init</span>(name: String) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.breed = <span style=color:#e6db74>&#34;yee&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.<span style=color:#66d9ef>init</span>(name: name)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=mvc-and-singleton>MVC and Singleton</h2><blockquote><p><a href=https://onevcat.com/2018/05/mvc-wrong-use/>MVC Explain</a></p></blockquote><p><img src=https://onevcat.com/assets/images/2018/mvc.png alt="MVC standford university"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ToDoStore</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>let</span> shared = ToDoStore()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span>(<span style=color:#66d9ef>set</span>) <span style=color:#66d9ef>var</span> items: [ToDoItem] = []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>init</span>() {}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>append</span>(item: ToDoItem) {
</span></span><span style=display:flex><span>        items.append(item)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> count: Int {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> items.count
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>item</span>(at index: Int) -&gt; ToDoItem {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> items[index]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ToDoListViewController</span>: UITableViewController {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>@objc</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>addButtonPressed</span>(<span style=color:#66d9ef>_</span> sender: Any) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> store = ToDoStore.shared
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> newCount = store.count <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> title = <span style=color:#e6db74>&#34;ToDo Item </span><span style=color:#e6db74>\(</span>newCount<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        store.append(item: .<span style=color:#66d9ef>init</span>(title: title))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>ToDoListViewController</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>tableView</span>(<span style=color:#66d9ef>_</span> tableView: UITableView, trailingSwipeActionsConfigurationForRowAt indexPath: IndexPath) -&gt; UISwipeActionsConfiguration? {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> deleteAction = UIContextualAction(style: .destructive, title: <span style=color:#e6db74>&#34;Delete&#34;</span>) { <span style=color:#66d9ef>_</span>, <span style=color:#66d9ef>_</span>, done <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>            ToDoStore.shared.remove(at: indexPath.row)
</span></span><span style=display:flex><span>            done(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> UISwipeActionsConfiguration(actions: [deleteAction])
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=stateobject-and-observedobject>@StateObject and @ObservedObject</h2><blockquote><p><a href=https://www.hackingwithswift.com/quick-start/swiftui/how-to-use-observedobject-to-manage-state-from-external-objects>How to use @ObservedObject to manage state from external objects</a></p><p>You should not use this property wrapper to create the initial instance of an observable object – that’s what @StateObject is for.</p><p>Remember, please do not use @ObservedObject to create instances of your object. If that’s what you want to do, use @StateObject instead.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> {
</span></span><span style=display:flex><span>    @Published <span style=color:#66d9ef>var</span> score: Int = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>InnerView</span>: View {
</span></span><span style=display:flex><span>    @ObservedObject <span style=color:#66d9ef>var</span> progress: UserProgress
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        Button(<span style=color:#e6db74>&#34;Increase Score&#34;</span>) {
</span></span><span style=display:flex><span>            progress.score <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// This isn&#39;t recommended</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// @ObservedObject var progress = UserProgress()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @StateObject <span style=color:#66d9ef>var</span> progress = UserProgress()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        VStack {
</span></span><span style=display:flex><span>            Text(<span style=color:#e6db74>&#34;Your score is </span><span style=color:#e6db74>\(</span>progress.score<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            InnerView(progress: progress)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><video style=max-width:100% loop muted autoplay playsinline>
<source src=https://www.hackingwithswift.com/img/books/quick-start/swiftui/how-to-use-observedobject-to-manage-state-from-external-objects-1.mp4 type=video/mp4></video><blockquote><p><a href=https://onevcat.com/2020/06/stateobject/>StateObject & ObservedObject</a></p><p>Once you understand the issues with @ObservedObject, the significance of @StateObject becomes apparent. @StateObject is an upgrade of @State and is specifically designed to store ObservableObject class instances. While @State is created to store struct states, @StateObject is created to store ObservableObject class instances. It ensures that the instance of this class will not be recreated with the view, thus solving the problem.</p></blockquote><p><img src=https://onevcat.com/assets/images/2020/stateobject_reset.gif alt="@ObservedObject Problem"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> showRealName = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        VStack {
</span></span><span style=display:flex><span>            Button(<span style=color:#e6db74>&#34;Toggle Name&#34;</span>) {
</span></span><span style=display:flex><span>                showRealName.toggle()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            Text(<span style=color:#e6db74>&#34;Current User: </span><span style=color:#e6db74>\(</span>showRealName ? <span style=color:#e6db74>&#34;Wei Wang&#34;</span> : <span style=color:#e6db74>&#34;onevcat&#34;</span><span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            ScorePlate().padding(.top, <span style=color:#ae81ff>20</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Model</span>: ObservableObject {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>init</span>() { print(<span style=color:#e6db74>&#34;Model Created&#34;</span>) }
</span></span><span style=display:flex><span>    @Published <span style=color:#66d9ef>var</span> score: Int = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ScorePlate</span>: View {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    @ObservedObject <span style=color:#66d9ef>var</span> model = Model()
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> niceScore = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        VStack {
</span></span><span style=display:flex><span>            Button(<span style=color:#e6db74>&#34;+1&#34;</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> model.score <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>3</span> {
</span></span><span style=display:flex><span>                    niceScore = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                model.score <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            Text(<span style=color:#e6db74>&#34;Score: </span><span style=color:#e6db74>\(</span>model.score<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            Text(<span style=color:#e6db74>&#34;Nice? </span><span style=color:#e6db74>\(</span>niceScore ? <span style=color:#e6db74>&#34;YES&#34;</span> : <span style=color:#e6db74>&#34;NO&#34;</span><span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            ScoreText(model: model).padding(.top, <span style=color:#ae81ff>20</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ScoreText</span>: View {
</span></span><span style=display:flex><span>    @ObservedObject <span style=color:#66d9ef>var</span> model: Model
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> model.score <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>10</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Text(<span style=color:#e6db74>&#34;Fantastic&#34;</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> model.score <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>3</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Text(<span style=color:#e6db74>&#34;Good&#34;</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Text(<span style=color:#e6db74>&#34;Ummmm...&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p><a href=https://www.hackingwithswift.com/quick-start/swiftui/what-is-the-observedobject-property-wrapper>hws - What is the @ObservedObject property wrapper?</a></p><p>That Order class uses @Published so it will automatically send change announcements when items changes, and ContentView uses @ObservedObject to watch for those announcements. Without @ObservedObject the change announcements would be sent but ignored.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Order</span>: ObservableObject {
</span></span><span style=display:flex><span>    @Published <span style=color:#66d9ef>var</span> items = [String]()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    @ObservedObject <span style=color:#66d9ef>var</span> order: Order
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// your code here</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=observableobject>ObservableObject</h2><ul><li><a href=https://www.fatbobman.com/posts/observableObject-study/>ObservableObject 研究——想说爱你不容易</a></li></ul><p><img src=https://cdn.fatbobman.com/observableObject-study-reduximage.gif alt="reducer image"></p><h2 id=custom-subclass-of-nsobject>Custom Subclass of NSObject</h2><blockquote><p><a href=https://www.hackingwithswift.com/read/10/5/custom-subclasses-of-nsobject>Custom subclasses of NSObject</a></p><p>NSObject is what&rsquo;s called a universal base class for all Cocoa Touch classes. That means all UIKit classes ultimately come from NSObject, including all of UIKit. You don&rsquo;t have to inherit from NSObject in Swift, but you did in Objective-C and in fact there are some behaviors you can only have if you do inherit from it. More on that in project 12, but for now just make sure you inherit from NSObject.</p><p><a href=https://www.hackingwithswift.com/read/12/3/fixing-project-10-nscoding>hws - project 12</a></p><p>Why do we need a class here when a struct will do just as well? (And in fact better, because structs come with a default initializer!)</p><p>Why do we need to inherit from NSObject?</p><p>It&rsquo;s time for the answers to become clear. You see, working with NSCoding requires you to use objects, or, in the case of strings, arrays and dictionaries, structs that are interchangeable with objects. If we made the Person class into a struct, we couldn&rsquo;t use it with NSCoding.</p><p>The reason we inherit from NSObject is again because it&rsquo;s required to use NSCoding – although cunningly Swift won&rsquo;t mention that to you, your app will just crash.</p></blockquote><h2 id=getter--setter-and-property-wrapper>Getter / Setter and Property Wrapper</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Person</span>: NSObject { 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> name: String? {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>get</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>self</span>.name
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>set</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.name = newValue
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p><a href=https://juejin.cn/post/6844904018121064456>Juejin</a></p><p><a href=https://blog.csdn.net/morris_/article/details/121145391>Swift set/get方法</a></p><p>为什么不直接返回name或者直接给name赋值呢，而是通过另外一个变量 _name 来存储真正的值呢？</p><p>这么写会陷入 self.name 的死循环的哦，所以不能这样写。</p><p>本质上 <code>_name</code> 这个变量存储真正的值，name 这个变量更多的作用相当于提供了一个方法，提供了其set和get方法，通过他的set和get方法给 <code>_name</code> 赋值。这一点和OC是一样一样的。</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Person</span>: NSObject { 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> _name: String?
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> name: String? {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>get</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> _name
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>set</span> {
</span></span><span style=display:flex><span>            _name = newValue
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>HasWrapper</span> {
</span></span><span style=display:flex><span>    @Wrapper <span style=color:#66d9ef>var</span> x = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>foo</span>() {
</span></span><span style=display:flex><span>        print(x) <span style=color:#75715e>// `wrappedValue`</span>
</span></span><span style=display:flex><span>        print(_x) <span style=color:#75715e>// wrapper type itself</span>
</span></span><span style=display:flex><span>        print(<span style=color:#960050;background-color:#1e0010>$</span>x) <span style=color:#75715e>// `projectedValue`</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></article></html>