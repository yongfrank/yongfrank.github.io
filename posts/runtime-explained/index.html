<!doctype html><html lang=en-us><title>Runtime Explained | Blog by Frank</title><meta charset=utf-8><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZQ6YTCMN7"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XZQ6YTCMN7")}</script><meta name=twitter:card content="summary_large_image"><meta property="og:type" content="article"><meta property="og:title" content="Runtime Explained | Blog by Frank"><meta name=twitter:title content="Runtime Explained | Blog by Frank"><meta property="og:description" content="RUNTIME
Generally

Compile time error
Link time
Runtime error


  
      
          
          Compile Time Error
          Runtime Error
      
  
  
      
          Time
          Earlier
          Later
      
      
          Error
          Grammar Error, Semantic Error
          Memory Error, Math Error
      
      
          
          Easy
          Hard
      
  

Specifically

Runtime Library (stdio.h)
Runtime Environment

No Runtime: C/C++, Rust
Light Runtime: Golang
Heavy Runtime: Java(JVM), Python(CPython), C#(.NET Runtime)


JRE = JVM + Library


  
      
          
          No Runtime
          Runtime
      
  
  
      
          Memory Mgmt
          Mannually
          Automatically
      
      
          Thread Model
          Rely on OS
          Rely on Runtime
      
      
          System Interaction
          Directly
          Indirectly(rely on Runtime)
      
      
          Efficiency
          High
          Low(High on JIT)
      
      
          
          Bare Metal
          &mdash;&mdash;-
      
  

运行时 = 运行时环境 + 运行时库"><meta property="og:url" content="https://yongfrank.github.io/posts/runtime-explained/"><meta property="og:site_name" content="Blog by Frank"><meta name=generator content="Hugo 0.154.0"><meta name=description content="Explorations, Reflections, and More on My Blog"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://yongfrank.github.io/css/index.css><link rel=canonical href=https://yongfrank.github.io/posts/runtime-explained/><link rel=alternate type=application/rss+xml href title="Blog by Frank"><link rel=stylesheet href=https://yongfrank.github.io/katex/katex.min.css><link rel="shortcut icon" href=favicon.ico><script defer src=https://yongfrank.github.io/katex/katex.min.js></script><script defer src=https://yongfrank.github.io/katex/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#578490><meta name=msapplication-TileColor content="#da532c"><head><script src=/js/MathJax/es5/tex-chtml.js></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6555780148434263" crossorigin=anonymous></script></head><header><a href=https://yongfrank.github.io/ class=title>Blog by Frank</a><nav><a href=/about/>About</a></nav></header><article><header><h1>Runtime Explained</h1><time datetime=2023-01-03T16:13:29+08:00>January 03, 2023</time></header><nav id=TableOfContents><ul><li><a href=#runtime>RUNTIME</a><ul><li><a href=#generally>Generally</a></li><li><a href=#specifically>Specifically</a></li></ul></li><li><a href=#coding>Coding</a><ul><li><a href=#objective>Objective</a></li><li><a href=#method-swizzling>Method Swizzling</a></li><li><a href=#kvc-kvo>KVC, KVO</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav><h2 id=runtime>RUNTIME</h2><h3 id=generally>Generally</h3><ul><li>Compile time error</li><li>Link time</li><li>Runtime error</li></ul><table><thead><tr><th></th><th>Compile Time Error</th><th>Runtime Error</th></tr></thead><tbody><tr><td>Time</td><td>Earlier</td><td>Later</td></tr><tr><td>Error</td><td>Grammar Error, Semantic Error</td><td>Memory Error, Math Error</td></tr><tr><td></td><td>Easy</td><td>Hard</td></tr></tbody></table><h3 id=specifically>Specifically</h3><ul><li>Runtime Library (stdio.h)</li><li>Runtime Environment<ul><li>No Runtime: C/C++, Rust</li><li>Light Runtime: Golang</li><li>Heavy Runtime: Java(JVM), Python(CPython), C#(.NET Runtime)</li></ul></li><li>JRE = JVM + Library</li></ul><table><thead><tr><th></th><th>No Runtime</th><th>Runtime</th></tr></thead><tbody><tr><td>Memory Mgmt</td><td>Mannually</td><td>Automatically</td></tr><tr><td>Thread Model</td><td>Rely on OS</td><td>Rely on Runtime</td></tr><tr><td>System Interaction</td><td>Directly</td><td>Indirectly(rely on Runtime)</td></tr><tr><td>Efficiency</td><td>High</td><td>Low(High on JIT)</td></tr><tr><td></td><td>Bare Metal</td><td>&mdash;&mdash;-</td></tr></tbody></table><p>运行时 = 运行时环境 + 运行时库</p><p>面向硬件环境 = 无运行时 + 无运行库</p><p>Runtime（运行时）是一种基于 C 语言的库，它为 Objective-C 和 Swift 提供了一组动态运行时库函数，允许开发人员在运行时操作对象、类和协议，以及动态地创建类、添加方法、获取属性、关联对象等。</p><p>在 Objective-C 中，Runtime 可以用于通过字符串名称创建类、添加方法、交换方法实现、获取类的实例变量、获取对象的属性列表等。Runtime 还允许开发人员使用消息传递机制来调用方法，这是 Objective-C 对象之间通信的基础。通过使用 Runtime，开发人员可以在运行时动态地修改对象和类的行为，从而实现更加灵活的编程。</p><blockquote><p><a href=https://cloud.tencent.com/developer/article/1447051>OC史上最实用的 runtime 总结</a></p></blockquote><ol><li>将某些OC代码转为运行时代码，探究底层，比如block的实现原理（上边已讲到）；</li><li>拦截系统自带的方法调用（Swizzle 黑魔法），比如拦截imageNamed:、viewDidLoad、alloc；</li><li>实现分类也可以增加属性；</li><li>实现NSCoding的自动归档和自动解档；</li><li>实现字典和模型的自动转换。</li></ol><p>在 Swift 中，Runtime 的作用也很重要。Swift 在语言层面上提供了很多动态语言的特性，例如反射（Reflection）、动态派发（Dynamic Dispatch）等。这些功能都是通过 Swift Runtime 来实现的，因此可以说 Runtime 是支持 Swift 动态语言特性的基础。</p><p>Runtime 是 Apple 开发平台中许多重要框架的基础，例如 Cocoa Touch、UIKit、AppKit、Core Data、Foundation 等。除此之外，Runtime 还是许多第三方框架和库的基础，例如 AFNetworking、Mantle 等。</p><h2 id=coding>Coding</h2><h3 id=objective>Objective</h3><blockquote><p><a href=https://academy.realm.io/cn/posts/mobilization-roy-marmelstein-objective-c-runtime-swift-dynamic/>acedemy</a></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> objc_class <span style=color:#f92672>*</span><span style=color:#66d9ef>Class</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> objc_object {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>Class</span> isa;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> objc_class {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>Class</span> isa;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>Class</span> super_class;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>name;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>long</span> version;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>long</span> info;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>long</span> instance_size;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>struct</span> objc_ivar_list <span style=color:#f92672>*</span>ivars;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>struct</span> objc_method_list <span style=color:#f92672>**</span>methodLists;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>struct</span> objc_cache <span style=color:#f92672>*</span>cache;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>struct</span> objc_protocol_list <span style=color:#f92672>*</span>protocols;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h3 id=method-swizzling>Method Swizzling</h3><blockquote><p><a href=https://abhimuralidharan.medium.com/method-swizzling-in-ios-swift-1f38edaf984f>Method swizzling in iOS swift</a></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>UIKit</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Foundation</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>UIColor</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>@objc</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>colorDescription</span>() -&gt; String {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Print rainbow colours.&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>let</span> swizzleDescriptionImplementation: Void = {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> instance: UIColor = .red
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> aClass: AnyClass! = object_getClass(instance)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> originSelector: Selector = <span style=color:#66d9ef>#selector</span>(description)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> swizzledSelector: Selector = <span style=color:#66d9ef>#selector</span>(colorDescription)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> originalMethod: Method? = class_getInstanceMethod(aClass, originSelector)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> swizzledMethod: Method? = class_getInstanceMethod(aClass, swizzledSelector)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> originalMethod = originalMethod, <span style=color:#66d9ef>let</span> swizzledMethod = swizzledMethod {
</span></span><span style=display:flex><span>            method_exchangeImplementations(originalMethod, swizzledMethod)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>swizzleDescription</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.swizzleDescriptionImplementation
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(UIColor.red)
</span></span><span style=display:flex><span>print(UIColor.blue)
</span></span><span style=display:flex><span>UIColor.swizzleDescription()
</span></span><span style=display:flex><span>print(UIColor.red)
</span></span><span style=display:flex><span>print(UIColor.blue)
</span></span><span style=display:flex><span>UIColor.swizzleDescription()
</span></span><span style=display:flex><span>print(UIColor.red)
</span></span><span style=display:flex><span>print(UIColor.blue)
</span></span></code></pre></div><h3 id=kvc-kvo>KVC, KVO</h3><blockquote><p><a href=https://academy.realm.io/cn/posts/mobilization-roy-marmelstein-objective-c-runtime-swift-dynamic/>Realm</a></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-objc data-lang=objc><span style=display:flex><span><span style=color:#66d9ef>@property</span> (<span style=color:#66d9ef>nonatomic</span>, <span style=color:#66d9ef>strong</span>) NSNumber <span style=color:#f92672>*</span>number;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[myClass valueForKey:<span style=color:#e6db74>@&#34;number&#34;</span>];
</span></span><span style=display:flex><span>[myClass setValue:<span style=color:#ae81ff>@(</span><span style=color:#ae81ff>4</span><span style=color:#ae81ff>)</span> forKey:<span style=color:#e6db74>@&#34;number&#34;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[myClass addObserver:self
</span></span><span style=display:flex><span>    forKeyPath:<span style=color:#e6db74>@&#34;number&#34;</span>
</span></span><span style=display:flex><span>    options:NSKeyValueObservingOptionInitial <span style=color:#f92672>|</span> NSKeyValueObservingOptionNew
</span></span><span style=display:flex><span>    context:nil];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- (<span style=color:#66d9ef>void</span>)<span style=color:#a6e22e>observeValueForKeyPath:</span>(NSString <span style=color:#f92672>*</span>)keyPath
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>ofObject:</span>(<span style=color:#66d9ef>id</span>)object
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>change:</span>(NSDictionary<span style=color:#f92672>&lt;</span>NSKeyValueChangeKey,<span style=color:#66d9ef>id</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>*</span>)change
</span></span><span style=display:flex><span>                       <span style=color:#a6e22e>context:</span>(<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>)context{
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Respond to observation.
</span></span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=reference>Reference</h2><p><a href=https://www.bilibili.com/video/BV1Vr4y1G76c/>Discussion on RUNTIME - bilibili</a></p></article></html>