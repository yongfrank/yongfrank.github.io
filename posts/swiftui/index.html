<!doctype html><html lang=en-us><title>SwiftUI Example | Blog by Frank</title><meta charset=utf-8><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZQ6YTCMN7"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XZQ6YTCMN7",{anonymize_ip:!1})}</script><meta name=twitter:card content="summary_large_image"><meta property="og:type" content="article"><meta property="og:title" content="SwiftUI Example | Blog by Frank"><meta name=twitter:title content="SwiftUI Example | Blog by Frank"><meta property="og:description" content="This page is open source. Improve this page."><meta property="og:url" content="https://yongfrank.github.io/posts/swiftui/"><meta property="og:site_name" content="Blog by Frank"><meta name=generator content="Hugo 0.115.4"><meta name=description content="Explorations, Reflections, and More on My Blog"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://yongfrank.github.io/css/index.css><link rel=canonical href=https://yongfrank.github.io/posts/swiftui/><link rel=alternate type=application/rss+xml href title="Blog by Frank"><link rel=stylesheet href=https://yongfrank.github.io/katex/katex.min.css><link rel="shortcut icon" href=favicon.ico><script defer src=https://yongfrank.github.io/katex/katex.min.js></script>
<script defer src=https://yongfrank.github.io/katex/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#578490><meta name=msapplication-TileColor content="#da532c"><head><script src=/js/MathJax/es5/tex-chtml.js></script></head><header><a href=https://yongfrank.github.io/ class=title>Blog by Frank</a><nav><a href=/about/>About</a></nav></header><article><header><h1>SwiftUI Example</h1><time datetime=2023-04-03T01:39:20+08:00>April 03, 2023</time></header><nav id=TableOfContents><ul><li><a href=#starred-app>Starred App</a></li><li><a href=#working-with-static-text-laying-out-text-neatly>Working with static text (Laying out text neatly)</a><ul><li><a href=#working-with-attributedstring>Working with AttributedString</a></li></ul></li><li><a href=#stacks-grids-scrollviews>Stacks, grids, scrollviews</a></li><li><a href=#user-interface-controls>User interface controls</a></li><li><a href=#responding-to-events>Responding to events</a></li><li><a href=#tap-and-gestures>Tap and gestures</a></li><li><a href=#advanced-state>Advanced state</a></li><li><a href=#lists>Lists</a><ul><li><a href=#toggle-list>Toggle List</a></li></ul></li><li><a href=#navigation>Navigation</a></li><li><a href=#alerts-and-menus>Alerts and menus</a></li><li><a href=#presenting-views>Presenting Views</a></li><li><a href=#transforming-views>Transforming views</a></li><li><a href=#drawing>Drawing</a></li><li><a href=#animation>Animation</a><ul><li><a href=#confetti>Confetti</a></li></ul></li><li><a href=#composing-views>Composing views</a></li><li><a href=#cross-platform-swiftui>Cross-platform SwiftUI</a></li><li><a href=#preferencekey>PreferenceKey</a></li><li><a href=#error-handling>Error Handling</a><ul><li><a href=#modifying-state-during-view-update>Modifying State During View Update</a></li></ul></li><li><a href=#uikit-integration>UIKit Integration</a></li><li><a href=#uikit-preview>UIKit Preview</a></li><li><a href=#mainactor>MainActor</a></li><li><a href=#struct--class>Struct & Class</a></li><li><a href=#封装继承多态>封装、继承、多态</a><ul><li><a href=#c--cpp>C & Cpp</a></li></ul></li></ul></nav><p>This page is open source. <a href=https://github.com/yongfrank/yongfrank.github.io/edit/main/content/posts/swiftui.md>Improve this page</a>.</p><blockquote><ul><li><a href=https://www.hackingwithswift.com/quick-start/swiftui/>SwiftUI by Example</a></li><li><a href=https://www.cocoaz.com/swiftui/swiftui-vs-uikit-cheat-sheet/>SwiftUI 参考手册</a></li></ul></blockquote><h2 id=starred-app>Starred App</h2><p><a href="https://apps.apple.com/us/app/a-companion-for-swiftui/id1485436674?l=zh&amp;mt=12">A Companion for SwiftUI</a></p><p><a href="https://apps.apple.com/us/app/a-companion-for-swiftui/id1485436674?mt=12&amp;itscg=30200&amp;itsct=apps_box_appicon" style=width:170px;height:170px;border-radius:22%;overflow:hidden;display:inline-block;vertical-align:middle><img src=https://is1-ssl.mzstatic.com/image/thumb/Purple122/v4/3c/05/e9/3c05e92b-23a1-3d89-dee5-6bdf701c9bfa/AppIcon-0-85-220-0-4-2x.png/540x540bb.jpg alt="A Companion for SwiftUI" style=width:170px;height:170px;border-radius:22%;overflow:hidden;display:inline-block;vertical-align:middle></a></p><h2 id=working-with-static-text-laying-out-text-neatly>Working with static text (Laying out text neatly)</h2><blockquote><ul><li><a href=https://www.hackingwithswift.com/quick-start/swiftui/how-to-add-advanced-text-styling-using-attributedstring>hws - How to add advanced text styling using AttributedString</a></li><li><a href=https://www.hackingwithswift.com/quick-start/swiftui/how-to-render-markdown-content-in-text>hws - How to render Markdown content in text</a></li><li><a href=https://www.appcoda.com/swiftui-markdown/>Using Markdown in SwiftUI</a></li><li><a href=https://www.fatbobman.com/posts/attributedString/>AttributedString</a></li></ul></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> content: String? {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>? 
</span></span><span style=display:flex><span>            String(
</span></span><span style=display:flex><span>                contentsOf: Bundle.main.url(forResource: <span style=color:#e6db74>&#34;README&#34;</span>, withExtension: <span style=color:#e6db74>&#34;md&#34;</span>)<span style=color:#f92672>!</span>
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> txt: AttributedString {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> text = <span style=color:#66d9ef>try</span>! AttributedString(markdown: <span style=color:#e6db74>&#34;_Hamlet_ by William Shakespeare **Text in bold**&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> range = text.range(of: <span style=color:#e6db74>&#34;William&#34;</span>) {
</span></span><span style=display:flex><span>            text[range].backgroundColor = .yellow
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> text
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        VStack {
</span></span><span style=display:flex><span>            Text(content ?? <span style=color:#e6db74>&#34;?&#34;</span>)
</span></span><span style=display:flex><span>            Text(txt)
</span></span><span style=display:flex><span>            Text(<span style=color:#e6db74>&#34;**Text in bold**&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        .background(.red)
</span></span><span style=display:flex><span>        .padding()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This automatic Markdown conversion happens because SwiftUI interprets those strings as being instances of LocalizedStringKey – strings that can be localized by our app. This means if you want to create Markdown text from a property or variable, you should mark it explicitly as being LocalizedStringKey to get the Markdown rendering:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> markdownText: LocalizedStringKey = <span style=color:#e6db74>&#34;* This is **bold** text, this is *italic* text, and this is ***bold, italic*** text.&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        Text(markdownText)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=working-with-attributedstring>Working with AttributedString</h3><p><a href=https://www.hackingwithswift.com/quick-start/swiftui/>How to let users select text</a></p><p><img src=https://www.appcoda.com/wp-content/uploads/2022/03/swiftui-markdown-3.png alt="attributed string"></p><p>SwiftUI’s text component has a built-in support for AttributedString. You can simply pass it to the Text view for rendering.</p><h2 id=stacks-grids-scrollviews>Stacks, grids, scrollviews</h2><p>Position views in a structured way</p><blockquote><p><a href=https://www.hackingwithswift.com/quick-start/swiftui/how-to-position-views-in-a-grid-using-lazyvgrid-and-lazyhgrid>hws - How to position views in a grid using LazyVGrid and LazyHGrid</a></p></blockquote><p><img src=https://www.hackingwithswift.com/img/books/quick-start/swiftui/how-to-position-views-in-a-grid-using-lazyvgrid-and-lazyhgrid-1@2x.png alt=LazyVGrid></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>SwiftUI</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> columnLayout = [GridItem(.adaptive(minimum: <span style=color:#ae81ff>100</span>, maximum: <span style=color:#ae81ff>100</span>))]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> allColors: [Color] = [.pink, .red, .orange, .yellow, .green, .mint, .teal, .cyan, .blue, .indigo, .purple, .brown, .gray]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        ScrollView {
</span></span><span style=display:flex><span>            LazyVGrid(columns: columnLayout) {
</span></span><span style=display:flex><span>                ForEach(allColors.indices, id: <span style=color:#960050;background-color:#1e0010>\</span>.<span style=color:#66d9ef>self</span>) { index <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>                    RoundedRectangle(cornerRadius: <span style=color:#ae81ff>4.0</span>)
</span></span><span style=display:flex><span>                        .aspectRatio(<span style=color:#ae81ff>1.0</span>, contentMode: ContentMode.fit)
</span></span><span style=display:flex><span>                        .foregroundColor(allColors[index])
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        .padding()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p><a href=https://www.hackingwithswift.com/quick-start/swiftui/how-to-dismiss-the-keyboard-when-the-user-scrolls>hws - How to dismiss the keyboard when the user scrolls</a></p></blockquote><p>SwiftUI’s scrollDismissesKeyboard() modifier gives us precise control over how the keyboard should dismiss when the user scrolls around.</p><p>For example, we could place a TextField and TextEditor into a scroll view, and have them both dismiss the keyboard interactively like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> username = <span style=color:#e6db74>&#34;Anonymous&#34;</span>
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> bio = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        ScrollView {
</span></span><span style=display:flex><span>            VStack {
</span></span><span style=display:flex><span>                TextField(<span style=color:#e6db74>&#34;Name&#34;</span>, text: <span style=color:#960050;background-color:#1e0010>$</span>username)
</span></span><span style=display:flex><span>                    .textFieldStyle(.roundedBorder)
</span></span><span style=display:flex><span>                TextEditor(text: <span style=color:#960050;background-color:#1e0010>$</span>bio)
</span></span><span style=display:flex><span>                    .frame(height: <span style=color:#ae81ff>400</span>)
</span></span><span style=display:flex><span>                    .border(.quaternary, width: <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            .padding(.horizontal)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        .scrollDismissesKeyboard(.interactively)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>Use <code>.automatic</code> to let SwiftUI judge what’s the best thing to do based on the context of the scroll.</li><li>Use <code>.immediately</code> to make the keyboard dismiss fully as soon as any scroll happens.</li><li>Use <code>.interactively</code> to make the keyboard dismiss inline with the user’s gesture – they need to scroll further to make it dismiss fully.</li><li>Use <code>.never</code> if you want the keyboard to remain present during scrolling.</li></ul><h2 id=user-interface-controls>User interface controls</h2><p>Respond to interaction and control your program state</p><blockquote><p><a href=https://www.hackingwithswift.com/quick-start/swiftui/how-to-customize-the-submit-button-for-textfield-securefield-and-texteditor>How to customize the submit button for TextField, SecureField, and TextEditor</a></p></blockquote><p><img src=https://www.hackingwithswift.com/img/books/quick-start/swiftui/how-to-customize-the-submit-button-for-textfield-securefield-and-texteditor-1@2x.png alt="keyboard customize"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> username = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        TextField(<span style=color:#e6db74>&#34;Username&#34;</span>, text: <span style=color:#960050;background-color:#1e0010>$</span>username)
</span></span><span style=display:flex><span>            .submitLabel(.join)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><ul><li><a href=https://sarunw.com/posts/swiftui-multiline-textfield/>How to create multiline TextField in SwiftUI</a></li><li><a href=https://stackoverflow.com/questions/58210457/make-the-textfield-multiline-swiftui>iOS 16.0+ supprts multiline TextField.</a></li></ul></blockquote><p>axis: .horizontal will yield the same result as a normal text field.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>MultilineTextFieldExample</span>: View {
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>var</span> address = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {        
</span></span><span style=display:flex><span>        TextField(<span style=color:#e6db74>&#34;Address&#34;</span>, text: <span style=color:#960050;background-color:#1e0010>$</span>address, axis: .vertical)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            .textFieldStyle(.roundedBorder)
</span></span><span style=display:flex><span>            .padding()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><ul><li>How to make a TextField or TextEditor have default focus</li><li><a href=https://www.hackingwithswift.com/quick-start/swiftui/how-to-dismiss-the-keyboard-for-a-textfield>hws - How to dismiss the keyboard for a TextField</a></li></ul></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> name = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    @FocusState <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> nameIsFocused: Bool
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        VStack {
</span></span><span style=display:flex><span>            TextField(<span style=color:#e6db74>&#34;Enter your name&#34;</span>, text: <span style=color:#960050;background-color:#1e0010>$</span>name)
</span></span><span style=display:flex><span>                .focused(<span style=color:#960050;background-color:#1e0010>$</span>nameIsFocused)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            Button(<span style=color:#e6db74>&#34;Submit&#34;</span>) {
</span></span><span style=display:flex><span>                nameIsFocused = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><ul><li><a href=https://developer.apple.com/documentation/swiftui/toolbaritemplacement/keyboard>Apple Developers - Keyboard toolbar</a></li><li><a href=https://stackoverflow.com/questions/56491386/how-to-hide-keyboard-when-using-swiftui>How to hide keyboard when using SwiftUI?</a></li><li><a href=https://swiftwithmajid.com/2021/03/03/focusedvalue-and-focusedbinding-property-wrappers-in-swiftui/>FocusedValue and FocusedBinding property wrappers in SwiftUI</a></li><li><a href=https://www.kodeco.com/31569019-focus-management-in-swiftui-getting-started>Focus Management in SwiftUI: Getting Started</a></li></ul></blockquote><p><img src=https://i.stack.imgur.com/7oFYC.gif alt="keyboard toolbar"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// ♣️♥️♠️♦️ appear above the keyboard</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>Field</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> suit
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> rank
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>FieldKey</span>: FocusedValueKey {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>typealias</span> Value = Field
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>FocusedValues</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> field: Field? {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>get</span> { <span style=color:#66d9ef>self</span>[FieldKey.<span style=color:#66d9ef>self</span>] }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>set</span> { <span style=color:#66d9ef>self</span>[FieldKey.<span style=color:#66d9ef>self</span>] = newValue }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>KeyboardBarDemo</span>: View {
</span></span><span style=display:flex><span>    @FocusedValue(<span style=color:#960050;background-color:#1e0010>\</span>.field) <span style=color:#66d9ef>var</span> field: Field?
</span></span><span style=display:flex><span>    @FocusState <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> focusedField: Field?
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> suitText = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> rankText = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        HStack {
</span></span><span style=display:flex><span>            TextField(<span style=color:#e6db74>&#34;Suit&#34;</span>, text: <span style=color:#960050;background-color:#1e0010>$</span>suitText)
</span></span><span style=display:flex><span>                .focusedValue(<span style=color:#960050;background-color:#1e0010>\</span>.field, .suit)
</span></span><span style=display:flex><span>                .focused(<span style=color:#960050;background-color:#1e0010>$</span>focusedField, equals: .suit)
</span></span><span style=display:flex><span>                .textFieldStyle(.roundedBorder)
</span></span><span style=display:flex><span>            TextField(<span style=color:#e6db74>&#34;Rank&#34;</span>, text: <span style=color:#960050;background-color:#1e0010>$</span>rankText)
</span></span><span style=display:flex><span>                .focusedValue(<span style=color:#960050;background-color:#1e0010>\</span>.field, .rank)
</span></span><span style=display:flex><span>                .focused(<span style=color:#960050;background-color:#1e0010>$</span>focusedField, equals: .rank)
</span></span><span style=display:flex><span>                .textFieldStyle(.roundedBorder)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        .toolbar {
</span></span><span style=display:flex><span>            ToolbarItemGroup(placement: .keyboard) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> field == .suit {
</span></span><span style=display:flex><span>                    Button(<span style=color:#e6db74>&#34;♣️&#34;</span>, action: { <span style=color:#66d9ef>self</span>.suitText <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;♣️&#34;</span> })
</span></span><span style=display:flex><span>                    Button(<span style=color:#e6db74>&#34;♥️&#34;</span>, action: { <span style=color:#66d9ef>self</span>.suitText <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;♥️&#34;</span> })
</span></span><span style=display:flex><span>                    Button(<span style=color:#e6db74>&#34;♠️&#34;</span>, action: { <span style=color:#66d9ef>self</span>.suitText <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;♠️&#34;</span> })
</span></span><span style=display:flex><span>                    Button(<span style=color:#e6db74>&#34;♦️&#34;</span>, action: { <span style=color:#66d9ef>self</span>.suitText <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;♦️&#34;</span> })
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                Spacer()
</span></span><span style=display:flex><span>                Button(<span style=color:#e6db74>&#34;Done&#34;</span>) {
</span></span><span style=display:flex><span>                    focusedField = <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p><a href=https://www.hackingwithswift.com/forums/100-days-of-swift/adding-a-clear-button-to-a-textfield/12079>Adding a clear button to a TextField</a></p></blockquote><p>Just an update for this. If you add this modifier to TextField then you get the clear button.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>TextField(<span style=color:#e6db74>&#34;regex&#34;</span>, text: <span style=color:#960050;background-color:#1e0010>$</span>regexResearch, axis: .vertical)
</span></span><span style=display:flex><span>    .onAppear {
</span></span><span style=display:flex><span>        UITextField.appearance().clearButtonMode = .whileEditing
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h2 id=responding-to-events>Responding to events</h2><h2 id=tap-and-gestures>Tap and gestures</h2><blockquote><ul><li><a href=https://stackoverflow.com/questions/62733633/swiftui-tapgesture-and-longpressgesture-in-scrollview-with-tap-indication-not-wo>stackoverflow - SwiftUI TapGesture and LongPressGesture in ScrollView with tap indication not working</a></li><li><a href=https://developer.apple.com/forums/thread/127277>Apple Developers - Longpress and list scrolling</a></li></ul><p>Thank you very much for pointing this out. It solved my problem. I didn&rsquo;t considder having an empty onTapGesture handler would have any impact on the scrolling, but it does. Maybe the common use is to have the tap handler and then add longtap as an additional gesture (makes sense).
Thanks again :-)</p></blockquote><h2 id=advanced-state>Advanced state</h2><p>Learn how to bind objects and query the environment</p><blockquote><p><a href=https://www.hackingwithswift.com/quick-start/swiftui/how-to-use-observedobject-to-manage-state-from-external-objects>How to use @ObservedObject to manage state from external objects</a></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UserProgress</span>: ObservableObject {
</span></span><span style=display:flex><span>    @Published <span style=color:#66d9ef>var</span> score = <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>didSet</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> score <span style=color:#f92672>&gt;</span> highScore {
</span></span><span style=display:flex><span>                highScore = score
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @AppStorage(<span style=color:#e6db74>&#34;HighScore&#34;</span>) <span style=color:#66d9ef>var</span> highScore = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>InnerView</span>: View {
</span></span><span style=display:flex><span>    @ObservedObject <span style=color:#66d9ef>var</span> progress: UserProgress
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        Button(<span style=color:#e6db74>&#34;Increase Score&#34;</span>) {
</span></span><span style=display:flex><span>            progress.score <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    @StateObject <span style=color:#66d9ef>var</span> progress = UserProgress()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        VStack {
</span></span><span style=display:flex><span>            Text(<span style=color:#e6db74>&#34;Your score is </span><span style=color:#e6db74>\(</span>progress.score<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            InnerView(progress: progress)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=lists>Lists</h2><p>Create scrolling tables of data</p><ul><li><a href=https://www.hackingwithswift.com/quick-start/swiftui/how-to-add-a-search-bar-to-filter-your-data>How to add a search bar to filter your data</a></li></ul><h3 id=toggle-list>Toggle List</h3><blockquote><p><a href=https://stackoverflow.com/questions/67064272/toggle-selection-in-a-list-swiftui>Toggle selection in a list - SwiftUI</a></p></blockquote><p><img src=https://i.stack.imgur.com/Fc4lv.gif alt="Toggle List"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>SwiftUI</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>CellModel</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> id = UUID()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> title: String = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> content: String = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> desc: String = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> toggleState: Bool = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>var</span> shared: [CellModel] = [
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>init</span>(title: <span style=color:#e6db74>&#34;0&#34;</span>, content: <span style=color:#e6db74>&#34;&#34;</span>, desc: <span style=color:#e6db74>&#34;0&#34;</span>)
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>var</span> opened: [CellModel] = [
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>init</span>(title: <span style=color:#e6db74>&#34;1&#34;</span>, content: <span style=color:#e6db74>&#34;1&#34;</span>, desc: <span style=color:#e6db74>&#34;&#34;</span>),
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>init</span>(title: <span style=color:#e6db74>&#34;2&#34;</span>, content: <span style=color:#e6db74>&#34;2&#34;</span>, desc: <span style=color:#e6db74>&#34;&#34;</span>),
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>init</span>(title: <span style=color:#e6db74>&#34;3&#34;</span>, content: <span style=color:#e6db74>&#34;&#34;</span>, desc: <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>     @State <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> opened: [CellModel] = [
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>init</span>(title: <span style=color:#e6db74>&#34;1&#34;</span>, content: <span style=color:#e6db74>&#34;1&#34;</span>, desc: <span style=color:#e6db74>&#34;&#34;</span>),
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>init</span>(title: <span style=color:#e6db74>&#34;2&#34;</span>, content: <span style=color:#e6db74>&#34;2&#34;</span>, desc: <span style=color:#e6db74>&#34;&#34;</span>),
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>init</span>(title: <span style=color:#e6db74>&#34;3&#34;</span>, content: <span style=color:#e6db74>&#34;&#34;</span>, desc: <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        List {
</span></span><span style=display:flex><span>            Section { 
</span></span><span style=display:flex><span>                ForEach(CellModel.shared, id: <span style=color:#960050;background-color:#1e0010>\</span>.id) { item <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>                    Text(item.title)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            Section {
</span></span><span style=display:flex><span>                ForEach(<span style=color:#66d9ef>self</span>.opened.indices, id: <span style=color:#960050;background-color:#1e0010>\</span>.<span style=color:#66d9ef>self</span>) { index <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>                    HStack {
</span></span><span style=display:flex><span>                        VStack(alignment: .leading) {
</span></span><span style=display:flex><span>                            Toggle(opened[index].title, isOn: <span style=color:#960050;background-color:#1e0010>$</span>opened[index].toggleState)
</span></span><span style=display:flex><span>                            Text(opened[index].content)
</span></span><span style=display:flex><span>                                .font(.footnote)
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=navigation>Navigation</h2><p>Direct your user through data in your app</p><ul><li><a href=https://nilcoalescing.com/blog/ProgrammaticallyHideAndShowSidebarInSplitView/>Programmatically hide and show sidebar in split view</a></li><li><a href=https://www.hackingwithswift.com/quick-start/swiftui/how-to-hide-and-show-the-sidebar-programmatically>How to hide and show the sidebar programmatically</a></li><li><a href=https://www.hackingwithswift.com/quick-start/swiftui/how-to-customize-a-views-width-in-navigationsplitview>How to customize a view’s width in NavigationSplitView</a></li></ul><h2 id=alerts-and-menus>Alerts and menus</h2><blockquote><p><a href=https://www.hackingwithswift.com/quick-start/swiftui/how-to-show-an-alert>How to show an alert</a></p></blockquote><video width=100% src=https://www.hackingwithswift.com/img/books/quick-start/swiftui/how-to-show-an-alert-1.mp4 autoplay loop></video><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> showingAlert = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        Button(<span style=color:#e6db74>&#34;Show Alert&#34;</span>) {
</span></span><span style=display:flex><span>            showingAlert = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        .alert(<span style=color:#e6db74>&#34;Important message&#34;</span>, isPresented: <span style=color:#960050;background-color:#1e0010>$</span>showingAlert) {
</span></span><span style=display:flex><span>            Button(<span style=color:#e6db74>&#34;OK&#34;</span>, role: .cancel) { }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p><a href=https://www.hackingwithswift.com/quick-start/swiftui/how-to-recommend-another-app-using-appstoreoverlay>How to recommend another app using appStoreOverlay()</a></p></blockquote><video width=100% src=https://www.hackingwithswift.com/img/books/quick-start/swiftui/how-to-recommend-another-app-using-appstoreoverlay-1.mp4 autoplay loop></video><h2 id=presenting-views>Presenting Views</h2><p>Move your user from one view to another</p><h2 id=transforming-views>Transforming views</h2><p>Clip, size, scale, spin, and more</p><h2 id=drawing>Drawing</h2><p>Take control of rendering using custom shapes</p><h2 id=animation>Animation</h2><p>Bring your views to life with movement</p><blockquote><p><a href=https://www.hackingwithswift.com/quick-start/swiftui/how-to-add-and-remove-views-with-a-transition>How to add and remove views with a transition</a></p></blockquote><video src=https://www.hackingwithswift.com/img/books/quick-start/swiftui/how-to-add-and-remove-views-with-a-transition-1.mp4 width=100% autoplay loop autopictureinpicture></video><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> showDetails = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        VStack {
</span></span><span style=display:flex><span>            Button(<span style=color:#e6db74>&#34;Press to show details&#34;</span>) {
</span></span><span style=display:flex><span>                withAnimation {
</span></span><span style=display:flex><span>                    showDetails.toggle()
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> showDetails {
</span></span><span style=display:flex><span>                Text(<span style=color:#e6db74>&#34;Details go here.&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p><a href=https://designcode.io/swiftui-handbook-view-transition>View Transitions and Animations</a></p><p>To show a new view with transition, you can use the if statement with a show boolean state. On that new view, apply a transition modifier. The zIndex modifier ensures that when dismissing, the new view stays on top.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>@State <span style=color:#66d9ef>var</span> show = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>ZStack {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>!</span>show {
</span></span><span style=display:flex><span>        Text(<span style=color:#e6db74>&#34;View transition&#34;</span>)
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        VStack { Text(<span style=color:#e6db74>&#34;New View&#34;</span>) }
</span></span><span style=display:flex><span>            .transition(.move(edge: .bottom))
</span></span><span style=display:flex><span>            .zIndex(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>.onTapGesture {
</span></span><span style=display:flex><span>    show.toggle()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=confetti>Confetti</h3><blockquote><p><a href=https://www.appcoda.com/swiftui-confetti-animation/>How to Create Confetti Animations in SwiftUI</a></p></blockquote><p><img src=https://github.com/simibac/ConfettiSwiftUI/raw/master/Gifs/default.gif alt=Confetti></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// https://github.com/simibac/ConfettiSwiftUI.git</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>ConfettiSwiftUI</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>SwiftUI</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> counter: Int = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        Button(<span style=color:#e6db74>&#34;🎉&#34;</span>) {
</span></span><span style=display:flex><span>            counter <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        .confettiCannon(counter: <span style=color:#960050;background-color:#1e0010>$</span>counter)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=composing-views>Composing views</h2><p>Make your UI structure easier to understand</p><h2 id=cross-platform-swiftui>Cross-platform SwiftUI</h2><p>learn</p><blockquote><ul><li><a href=https://stackoverflow.com/questions/38894031/swift-how-to-detect-orientation-changes>Swift - How to detect orientation changes</a></li><li><a href=https://zhuanlan.zhihu.com/p/568441109>SwiftUI如何在iOS16中优雅的检测和适配横竖屏 - 青颜君的文章 - 知乎</a></li><li><a href=https://developer.apple.com/documentation/swiftui/food_truck_building_a_swiftui_multiplatform_app>Food Truck: Building a SwiftUI multiplatform app</a></li></ul></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// Deprecated</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>guard</span> <span style=color:#66d9ef>let</span> orientation = UIApplication.shared.windows.first?.windowScene?.interfaceOrientation 
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span> { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> orientation == .landscapeRight <span style=color:#f92672>||</span> orientation == .landscapeLeft {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Food Truck By Apple</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#if</span> <span style=color:#75715e>os</span>(<span style=color:#75715e>iOS</span>)
</span></span><span style=display:flex><span>@Environment (<span style=color:#960050;background-color:#1e0010>\</span>.verticalSizeClass) <span style=color:#66d9ef>var</span> verticalSizeClass
</span></span><span style=display:flex><span>@Environment(<span style=color:#960050;background-color:#1e0010>\</span>.horizontalSizeClass) <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> sizeClass
</span></span><span style=display:flex><span><span style=color:#75715e>#endif</span>
</span></span><span style=display:flex><span>@Environment(<span style=color:#960050;background-color:#1e0010>\</span>.dynamicTypeSize) <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> dynamicType
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>isCompact</span>(width: Double) -&gt; Bool {
</span></span><span style=display:flex><span>    <span style=color:#75715e>#if</span> <span style=color:#75715e>os</span>(<span style=color:#75715e>iOS</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>self</span>.sizeClass == .compact {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> verticalSizeClass == .compact {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>#endif</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>self</span>.<span style=color:#66d9ef>dynamicType</span> <span style=color:#f92672>&gt;=</span> dynamicTypeThreshold {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> width <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>self</span>.widthThreshold {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><table><thead><tr><th>Device</th><th>Landscape/Portrait</th><th>horizontalSizeClass</th><th>verticalSizeClass</th></tr></thead><tbody><tr><td>All iPhone</td><td>Portrait</td><td>compact</td><td>regular</td></tr><tr><td>iPhone (except Max、Plus)</td><td>Landscape</td><td>compact</td><td>compact</td></tr><tr><td>iPhone (Max、Plus)</td><td>Landscape</td><td>regular</td><td>compact</td></tr><tr><td>All iPad</td><td>Landscape & Portrait</td><td>regular</td><td>regular</td></tr></tbody></table><table><thead><tr><th>设备</th><th>横/竖屏</th><th>horizontalSizeClass</th><th>verticalSizeClass</th></tr></thead><tbody><tr><td>所有 iPhone</td><td>竖屏</td><td>compact</td><td>regular</td></tr><tr><td>iPhone (Max、Plus 除外)</td><td>横屏</td><td>compact</td><td>compact</td></tr><tr><td>iPhone (Max、Plus)</td><td>横屏</td><td>regular</td><td>compact</td></tr><tr><td>所有 iPad</td><td>横、竖屏</td><td>regular</td><td>regular</td></tr></tbody></table><h2 id=preferencekey>PreferenceKey</h2><blockquote><p><a href=https://www.appcoda.com.tw/swiftui-preferencekey/>SwiftUI 小技巧：透過 PreferenceKey 簡單對齊視圖</a></p></blockquote><p><img src=https://www.appcoda.com.tw/content/images/2019/12/1_QY4RlNdXQUq5owuQqrwvEw.png alt="before preference key"></p><p><img src=https://www.appcoda.com.tw/content/images/2019/12/1_wkJwKpz4CqmWmirN4uRYpg.png alt="after preference key"></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>SwiftUI</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>var</span> value1 = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>var</span> value2 = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>var</span> value3 = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>var</span> width: CGFloat? = <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        Form {
</span></span><span style=display:flex><span>            HStack {
</span></span><span style=display:flex><span>                Text(<span style=color:#e6db74>&#34;First Item&#34;</span>)
</span></span><span style=display:flex><span>                    .frame(width: width, alignment: .leading)
</span></span><span style=display:flex><span>                    .background(ColumnWidthEqualiserView())
</span></span><span style=display:flex><span>                TextField(<span style=color:#e6db74>&#34;Enter first item&#34;</span>, text: <span style=color:#960050;background-color:#1e0010>$</span>value1)
</span></span><span style=display:flex><span>                    .textFieldStyle(RoundedBorderTextFieldStyle())
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            HStack {
</span></span><span style=display:flex><span>                Text(<span style=color:#e6db74>&#34;Second Item&#34;</span>)
</span></span><span style=display:flex><span>                    .frame(width: width, alignment: .leading)
</span></span><span style=display:flex><span>                    .background(ColumnWidthEqualiserView())
</span></span><span style=display:flex><span>                TextField(<span style=color:#e6db74>&#34;Enter second item&#34;</span>, text: <span style=color:#960050;background-color:#1e0010>$</span>value2)
</span></span><span style=display:flex><span>                    .textFieldStyle(RoundedBorderTextFieldStyle())
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            HStack {
</span></span><span style=display:flex><span>                Text(<span style=color:#e6db74>&#34;Final  Item&#34;</span>)
</span></span><span style=display:flex><span>                    .frame(width: width, alignment: .leading)
</span></span><span style=display:flex><span>                    .background(ColumnWidthEqualiserView())
</span></span><span style=display:flex><span>                TextField(<span style=color:#e6db74>&#34;Enter third item&#34;</span>, text: <span style=color:#960050;background-color:#1e0010>$</span>value3)
</span></span><span style=display:flex><span>                    .textFieldStyle(RoundedBorderTextFieldStyle())
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }.modifier(ColumnWidth(width:<span style=color:#960050;background-color:#1e0010>$</span>width))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ColumnWidthPreference</span>: Equatable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> width: CGFloat
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ColumnWidthPreferenceKey</span>: PreferenceKey {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>typealias</span> Value = [ColumnWidthPreference]
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>var</span> defaultValue: [ColumnWidthPreference] = []
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>reduce</span>(value: <span style=color:#66d9ef>inout</span> [ColumnWidthPreference], nextValue: () -&gt; [ColumnWidthPreference]) {
</span></span><span style=display:flex><span>        value.append(contentsOf: nextValue())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ColumnWidthEqualiserView</span>: View {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        GeometryReader { geometry <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>            Rectangle()
</span></span><span style=display:flex><span>                .fill(Color.clear)
</span></span><span style=display:flex><span>                .preference(
</span></span><span style=display:flex><span>                    key: ColumnWidthPreferenceKey.<span style=color:#66d9ef>self</span>,
</span></span><span style=display:flex><span>                    value: [ColumnWidthPreference(width: geometry.frame(<span style=color:#66d9ef>in</span>: CoordinateSpace.global).width)]
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ColumnWidth</span>: ViewModifier {
</span></span><span style=display:flex><span>    @Binding <span style=color:#66d9ef>var</span> width: CGFloat?
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>body</span>(content: Content) -&gt; some View {
</span></span><span style=display:flex><span>        content
</span></span><span style=display:flex><span>            .onPreferenceChange(ColumnWidthPreferenceKey.<span style=color:#66d9ef>self</span>) { preferences <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> p <span style=color:#66d9ef>in</span> preferences {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>let</span> oldWidth = <span style=color:#66d9ef>self</span>.width ?? CGFloat.zero
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> p.width <span style=color:#f92672>&gt;</span> oldWidth {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>self</span>.width = p.width <span style=color:#f92672>+</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=error-handling>Error Handling</h2><h3 id=modifying-state-during-view-update>Modifying State During View Update</h3><p>&ldquo;Modifying state during view update, this will cause undefined behavior&rdquo; 是 SwiftUI 中的一个警告信息，意思是在视图更新期间修改状态会导致未定义的行为。</p><p>在 SwiftUI 中，视图是根据其状态（State）来自动更新和重新渲染的。当视图正在进行更新时，如果在该过程中修改了状态，会导致不一致的状态和行为，可能会引发错误或导致应用程序崩溃。</p><p>为了避免这个问题，建议在视图更新期间不要直接修改状态。相反，您应该通过操作符号或函数等方式来处理状态的更改，或者使用 DispatchQueue.main.async 将状态更改推迟到视图更新完成后。</p><p>示例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ContentView</span>: View {
</span></span><span style=display:flex><span>    @State <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> count = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> body: some View {
</span></span><span style=display:flex><span>        VStack {
</span></span><span style=display:flex><span>            Text(<span style=color:#e6db74>&#34;Count: </span><span style=color:#e6db74>\(</span>count<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>            Button(<span style=color:#e6db74>&#34;Increment&#34;</span>) {
</span></span><span style=display:flex><span>                DispatchQueue.main.async {
</span></span><span style=display:flex><span>                    count <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在上面的示例中，我们使用 DispatchQueue.main.async 将状态 count 的增量操作推迟到视图更新完成后执行，以避免在视图更新期间修改状态而导致的问题。</p><p>总而言之，要避免 &ldquo;Modifying state during view update, this will cause undefined behavior&rdquo; 警告，应该确保在视图更新期间不直接修改状态，而是通过正确的方式来处理状态的更改。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// Error Code from: [DropUI WWDC23](https://github.com/NuPlay/DropUI)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>IconDrawingView</span>: UIViewRepresentable {
</span></span><span style=display:flex><span>    @Binding <span style=color:#66d9ef>var</span> drawing: PKDrawing
</span></span><span style=display:flex><span>    @Binding <span style=color:#66d9ef>var</span> toolPickerIsActive: Bool
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>let</span> toolPicker = PKToolPicker()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>makeCoordinator</span>() -&gt; Coordinator {
</span></span><span style=display:flex><span>        Coordinator(<span style=color:#66d9ef>self</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>makeUIView</span>(context: Context) -&gt; PKCanvasView {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> canvasView = PKCanvasView()
</span></span><span style=display:flex><span>        canvasView.drawing = drawing
</span></span><span style=display:flex><span>        canvasView.delegate = context.coordinator
</span></span><span style=display:flex><span>        canvasView.drawingPolicy = .anyInput
</span></span><span style=display:flex><span>        canvasView.backgroundColor = UIColor.white
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        toolPicker.setVisible(<span style=color:#66d9ef>true</span>, forFirstResponder: canvasView)
</span></span><span style=display:flex><span>        toolPicker.addObserver(canvasView)
</span></span><span style=display:flex><span>        canvasView.becomeFirstResponder()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> canvasView
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>updateUIView</span>(<span style=color:#66d9ef>_</span> uiView: PKCanvasView, context: Context) {
</span></span><span style=display:flex><span>        uiView.drawing = drawing
</span></span><span style=display:flex><span>        toolPicker.setVisible(toolPickerIsActive, forFirstResponder: uiView)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Coordinator</span>: NSObject, PKCanvasViewDelegate {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> parent: IconDrawingView
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>init</span>(<span style=color:#66d9ef>_</span> parent: IconDrawingView) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>self</span>.parent = parent
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>canvasViewDrawingDidChange</span>(<span style=color:#66d9ef>_</span> canvasView: PKCanvasView) {
</span></span><span style=display:flex><span>            parent.drawing = canvasView.drawing
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=uikit-integration>UIKit Integration</h2><blockquote><p><a href=https://zhuanlan.zhihu.com/p/133444068>访问 SwiftUI 内部的 UIKit 组件 - 猫克杯的文章 - 知乎</a></p></blockquote><h2 id=uikit-preview>UIKit Preview</h2><blockquote><p><a href=https://ruipfcosta.github.io/UIKitPreviewsGenerator-Website/index.html>UIKit Preview</a></p></blockquote><video style="max-width:100%;box-shadow:rgba(50,50,93,.25)0 50px 100px -20px,#000 0 30px 60px -30px" loop muted autoplay playsinline>
<source src=https://ruipfcosta.github.io/UIKitPreviewsGenerator-Website/assets/video/demo.mov></video><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>UIKit</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ViewController</span>: UINavigationController {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>viewDidLoad</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.viewDidLoad()
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Do any additional setup after loading the view.</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> text = UILabel(frame: CGRect(x: <span style=color:#ae81ff>20</span>, y: <span style=color:#ae81ff>20</span>, width: <span style=color:#ae81ff>300</span>, height: <span style=color:#ae81ff>300</span>))
</span></span><span style=display:flex><span>        text.text = <span style=color:#e6db74>&#34;UIKit Preview Testing&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.view.addSubview(text)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#if</span> <span style=color:#75715e>DEBUG</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>SwiftUI</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ViewControllerRepresentable</span>: UIViewControllerRepresentable {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>typealias</span> UIViewControllerType = ViewController
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>makeUIViewController</span>(context: Context) -&gt; UIViewControllerType {
</span></span><span style=display:flex><span>        ViewController()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>updateUIViewController</span>(<span style=color:#66d9ef>_</span> uiViewController: UIViewControllerType, context: Context) {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ViewController_Previews</span>: PreviewProvider {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>var</span> previews: some View {
</span></span><span style=display:flex><span>        ViewControllerRepresentable()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=mainactor>MainActor</h2><blockquote><p><a href=https://www.jianshu.com/p/a91d1ceaf7ef>Swift 中的 MainActor 使用和主线程调度</a></p><p>MainActor 是Swift 5.5中引入的一个新属性，它是一个全局 actor，提供一个在主线程上执行任务的执行器。在构建应用程序时，在主线程上执行UI更新任务是很重要的，在使用几个后台线程时，这有时会很有挑战性。使用@MainActor属性将帮助你确保你的UI总是在主线程上更新。</p></blockquote><h2 id=struct--class>Struct & Class</h2><p><a href=https://www.hackingwithswift.com/quick-start/understanding-swift/why-does-swift-have-both-classes-and-structs>Why does Swift have both classes and structs?</a></p><ul><li>Variable properties in constant classes can be modified freely, but variable properties in constant structs cannot. 常量类中的变量属性可以自由修改，但常量结构中的变量属性不能。</li><li>Classes have deinitializers, which are methods that are called when an instance of the class is destroyed, but structs do not.</li><li>Copies of structs are always unique, whereas copies of classes actually point to the same shared data.</li><li>One class can be built upon (“inherit from”) another class, gaining its properties and methods.</li><li>Classes do not come with synthesized memberwise initializers.</li></ul><p><a href=https://www.hackingwithswift.com/books/ios-swiftui/why-state-only-works-with-structs>Why @State only works with structs</a></p><p>Previously we looked at the differences between classes and structs, and there were two important differences I mentioned. First, that structs always have unique owners, whereas with classes multiple things can point to the same value. And second, that classes don’t need the mutating keyword before methods that change their properties, because you can change properties of constant classes.</p><p>When User was a struct, every time we modified a property of that struct Swift was actually creating a new instance of the struct. @State was able to spot that change, and automatically reloaded our view. Now that we have a class, that behavior no longer happens: Swift can just modify the value directly.</p><p>For SwiftUI developers, what this means is that if we want to share data between multiple views – if we want two or more views to point to the same data so that when one changes they all get those changes – we need to use classes rather than structs. 对于 SwiftUI 开发人员来说，这意味着，如果我们想在多个视图之间共享数据——如果我们希望两个或多个视图指向相同的数据，以便当一个视图更改时，它们都会得到这些更改——我们需要使用类而不是结构。</p><p>When User was a struct, every time we modified a property of that struct Swift was actually creating a new instance of the struct. @State was able to spot that change, and automatically reloaded our view. Now that we have a class, that behavior no longer happens: Swift can just modify the value directly.
当 User 是一个结构体时，每次我们修改该结构的属性时，Swift 实际上都在创建该结构体的新实例。 @State 能够发现该更改，并自动重新加载我们的视图。现在我们有一个类，这种行为不再发生：Swift 可以直接修改值。</p><p>Remember how we had to use the mutating keyword for struct methods that modify properties? This is because if we create the struct’s properties as variable but the struct itself is constant, we can’t change the properties – Swift needs to be able to destroy and recreate the whole struct when a property changes, and that isn’t possible for constant structs. Classes don’t need the mutating keyword, because even if the class instance is marked as constant Swift can still modify variable properties.
还记得我们如何将 mutating 关键字用于修改属性的结构方法吗？这是因为如果我们创建结构的属性为变量，但结构本身是常量的，我们就无法更改属性——Swift 需要能够在属性更改时销毁并重新创建整个结构，而这对于常量结构来说是不可能的。类不需要 mutating 关键字，因为即使类实例被标记为常量，Swift 仍然可以修改变量属性。</p><p>I know that all sounds terribly theoretical, but here’s the twist: now that User is a class the property itself isn’t changing, so @State doesn’t notice anything and can’t reload the view. Yes, the values inside the class are changing, but @State doesn’t monitor those, so effectively what’s happening is that the values inside our class are being changed but the view isn’t being reloaded to reflect that change.
我知道这一切听起来都很理论化，但这里有一个转折点：现在 User 这是一个类，属性本身没有改变，所以 @State 没有注意到任何东西，也无法重新加载视图。是的，类中的值正在更改，但不 @State 监视这些值，因此实际上正在发生的事情是我们类中的值正在更改，但视图未重新加载以反映该更改。</p><p>To fix this, it’s time to leave @State behind. Instead we need a more powerful property wrapper called @StateObject – let’s look at that now…
为了解决这个问题，是时候抛弃 @State 了。相反，我们需要一个更强大的属性包装器，称为 @StateObject – 现在让我们看看&mldr;&mldr;</p><p><a href=https://zhuanlan.zhihu.com/p/102707163>[SwiftUI 知识碎片] 为什么SwiftUI 用struct来表示view? - 猫克杯的文章 - 知乎</a></p><p>structs are simpler and faster than classes</p><p>在 UIKit 中，所有的视图都继承自一个叫 UIView 的类，它有非常多的属性和方法 —— 背景颜色，布局约束，用于渲染的层，等等。还有更多诸如此类的属性，而每一个 UIView 和 UIView 的子类都有，因为这正是继承的工作方式。</p><p>通常这样也不会带来问题，但有一个特殊的子类叫 UIStackView，它和 SwiftUI 里的 VStack 和HStack 相似。在 UIKit 里，出于使布局更简单的设计意图，UIStackView 是一个不会被渲染的视图类型。但由于继承机制，尽管它不渲染，它也有那些包括背景颜色在内的各种用不上的属性。</p><p>得益于现代 iPhone 的能力，创建 1000 甚至 100,000 个整数只在眨眼之间。对于 SwiftUI 的 1000 个 view 或者 100,000 个 view。这个时间仍然成立。太快了，你都不必考虑它们。</p><p>🌟🌟<a href=https://www.hackingwithswift.com/articles/227/which-swiftui-property-wrapper>在任何情况下选择哪个 SwiftUI 属性包装器</a></p><p><a href=https://www.jianshu.com/p/3cb186ad1ebf>SwiftUI学习-2 Struct和Class - Jianshu</a></p><p>• 2. Struct是为了函数式编程（functional programming）而构建的，而Class是为了面向对象形式编程（Object-oriented programming）而构建。</p><p>函数式编程专注于事物的功能特性。大多数我们看到的都是Struct，比如说：Array、Dictionary、Int、Bool、Double等。面向对象编程重点是封装数据，并将功能放到某个容器中，一个Object对象。 复制一个东西，还是使用一个指针，导致的行为是大为不同的。</p><h2 id=封装继承多态>封装、继承、多态</h2><p><a href=https://juejin.cn/post/6946378171683962917>多态及实现原理</a></p><p>什么是多态？父类指针指向子类对象就是多态。</p><p>类生成的汇编代码非常多，相比结构体复杂了很多，并且通过函数调用发现，函数地址是动态变化的。所以，如果没有继承行为或简单的类，建议使用结构体，效率更高。</p><p>类的函数调用地址之所以变化是为因为子类继承父类会导致函数实际调用地址发生变化，这也是多态的体现。</p><p><img src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/541baf907725411bb83960a3e0160b9b~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.image alt=汇编分析></p><p>分析： 类的实例前8个字节保存的是类的信息，所以上面的汇编代码会一值围绕着实例animal的前8个字节去查找函数地址。而animal最后一次指向的是对象Dog在堆空间的内存，所以最终调用的是Dog中的speak函数。</p><p>callq *0x50(%rcx)中的0x50就是偏移量，跳过0x50就是函数speak的地址。</p><p><img src=https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/922f4c7e019a4bcfa7df0dece67595bf~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.image alt="虚表 Virtual method table"></p><p>虚表是一个函数指针数组，数组里存放的都是函数指针，指向虚函数所在的位置。 对象调用虚函数时，会根据虚指针找到虚表的位置，再根据虚函数声明的顺序找到虚函数在数组的哪个位置，找到虚函数的地址，从而调用虚函数。</p><p>总结起来其实很简单：</p><ul><li>先找到全局变量 animal 的地址；</li><li>animal 地址保存的是堆空间 Dog 对象的内存地址；</li><li>Dog 对象前8个字节保存的是对象类型信息地址；</li><li>对象类型信息地址保存着类中函数的地址。</li></ul><h3 id=c--cpp>C & Cpp</h3><ul><li>C是面向过程的语言，是一个结构化的语言，考虑如何通过一个过程对输入进行处理得到输出；</li><li>C++是面向对象的语言，主要特征是“封装、继承和多态”。</li></ul><ol><li>封装隐藏了实现细节，使得代码模块化；</li><li>派生类可以继承父类的数据和方法，扩展了已经存在的模块，实现了代码重用；</li><li>多态则是“一个接口，多种实现”，通过派生类重写父类的虚函数，实现了接口的重用。</li></ol><blockquote><p><a href=https://www.zhihu.com/question/565523776/answer/2855918261>为什么 SwiftUI 用 some View 作为视图类型？ - 吏小加的回答 - 知乎</a></p></blockquote><p>在 SwiftUI 中使用 some View 作为视图类型，是因为它表示该结构体返回的是一个视图，但不需要知道该视图的具体类型是什么。通过它可以返回任何类型的视图结构体，在各种复杂的高级组件中，经常会看到这种使用方式。从原理上来说，它通过一种类型约束，被称为 opaque return types。该特性允许编译器自行推断返回的视图类型，而不需要开发者去显式地指定它。some 属于 Swift 一种特殊的通用类型占位符，可以支持更加复杂的多种视图类型的组合与复用，让编写的 SwiftUI 代码变得更加灵活简洁，减少了类型错误的可能性，这也是 SwiftUI 多态性的一种体现。</p></article></html>